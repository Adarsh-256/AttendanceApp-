<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Summary</title>

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    h2, h3 {
      text-align: center;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 17px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
      cursor: pointer;
      font-weight: 600;
    }

    ul {
      padding-left: 20px;
      font-size: 18px;
    }
  </style>

  <!-- PDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body>

<div class="container">

  <h2>Present Students</h2>

  <h3 id="info"></h3>

  <ul id="presentList"></ul>

  <button onclick="downloadPDF()">Download Attendance</button>

</div>

<script>
  const attendance = JSON.parse(localStorage.getItem("attendance_data"));
  const date = localStorage.getItem("attendance_date");
  const subject = localStorage.getItem("attendance_subject");

  document.getElementById("info").innerHTML =
    `Date: <b>${date}</b> | Subject: <b>${subject}</b>`;

  const presentList = document.getElementById("presentList");
  let presentStudents = [];

  // Display only present students
  for (let name in attendance) {
    if (attendance[name] === "Present") {
      presentStudents.push(name);
      let li = document.createElement("li");
      li.textContent = name;
      presentList.appendChild(li);
    }
  }

  if (presentStudents.length === 0) {
    presentList.innerHTML = "<li>No students present today.</li>";
  }

  // PDF Generator
  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 20;

    doc.setFont("Helvetica", "bold");
    doc.setFontSize(16);
    doc.text("Attendance Summary", 70, y);

    y += 10;
    doc.setFontSize(12);
    doc.setFont("Helvetica", "normal");
    doc.text(`Date: ${date}`, 20, y);
    y += 7;
    doc.text(`Subject: ${subject}`, 20, y);

    y += 15;
    doc.setFont("Helvetica", "bold");
    doc.text("Present Students:", 20, y);

    y += 10;
    doc.setFont("Helvetica", "normal");

    presentStudents.forEach((student, index) => {
      if (y > 280) {     // new page if content goes beyond limit
        doc.addPage();
        y = 20;
      }
      doc.text(`${index + 1}. ${student}`, 20, y);
      y += 8;
    });

    doc.save(`Attendance_${date}.pdf`);
  }
</script>

</body>
</html>
